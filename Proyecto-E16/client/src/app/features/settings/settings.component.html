<div class="container">
  <!-- Header -->
  <div class="header">
    <h1>Configuración</h1>
    <p class="subtitle">Personaliza tu experiencia en Tempo</p>
  </div>

  <!-- Tabs -->
  <div class="flex flex-wrap gap-3 mb-8 overflow-x-auto pb-2">
    <button 
      class="btn-pill" 
      [ngClass]="activeTab === 'profile' ? 'btn-add' : 'btn-secondary'" 
      (click)="activeTab = 'profile'">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg> Perfil
    </button>

    <button 
      class="btn-pill" 
      [ngClass]="activeTab === 'preferences' ? 'btn-add' : 'btn-secondary'" 
      (click)="activeTab = 'preferences'">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/>
        <line x1="4" x2="20" y1="18" y2="18"/><circle cx="12" cy="12" r="2"/>
        <circle cx="12" cy="6" r="2"/><circle cx="12" cy="18" r="2"/>
      </svg>
      Preferencias
    </button>
    <button 
      class="btn-pill" 
      [ngClass]="activeTab === 'history' ? 'btn-add' : 'btn-secondary'" 
      (click)="onTabChange('history')">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <polyline points="12 6 12 12 16 14"></polyline>
      </svg>
      Historial
    </button>
    <button 
      class="btn-pill" 
      [ngClass]="activeTab === 'likes' ? 'btn-add' : 'btn-secondary'" 
      (click)="onTabChange('likes')">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
      </svg>
      Likes
    </button>
    <button 
      class="btn-pill" 
      [ngClass]="activeTab === 'storage' ? 'btn-add' : 'btn-secondary'" 
      (click)="activeTab = 'storage'">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
        <polyline points="17 21 17 13 7 13 7 21"></polyline>
        <polyline points="7 3 7 8 15 8"></polyline>
      </svg>
      Almacenamiento
    </button>
  </div>

  <!-- 1. PERFIL (Inputs con Iconos) -->
  <ng-container *ngIf="activeTab === 'profile'">
    <div class="card">
      <h2>Información del Perfil</h2>
      <p class="description">Administra tu información personal</p>
      
      <!-- Avatar + Cámara -->
      <div class="flex flex-col items-center mb-8">
        <div class="relative group cursor-pointer" (click)="fileInput.click()">
          <img 
            [src]="displayAvatar" 
            class="avatar-xl object-cover border-4 border-[#141422] shadow-2xl"
            alt="Foto de perfil"
          />
          <input type="file" #fileInput (change)="onFileSelected($event)" style="display: none;">
          
          <!-- Overlay Hover -->
          <div class="absolute inset-0 bg-black/40 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center">
            <span class="text-white font-medium text-sm">Cambiar</span>
          </div>

          <!-- Botón Mini Cámara -->
          <div class="mini-camera-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
              <circle cx="12" cy="13" r="4"></circle>
            </svg>
          </div>
        </div>
        <p class="mt-3 text-gray-400 text-sm">Toca la foto para cambiarla</p>
      </div>

      <!-- INPUT: Nombre de Usuario -->
      <div class="form-group">
        <label>Nombre de usuario</label>
        <div class="relative">
          <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-3.92 7.94"/></svg>
          </div>
          <input type="text" [(ngModel)]="user.username_" class="!pl-14 w-full" placeholder="Tu nombre de usuario">
        </div>
      </div>

      <!-- INPUT: Correo -->
      <div class="form-group">
        <label>Correo electrónico</label>
        <div class="relative">
          <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none">
             <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
          </div>
          <input type="email" [(ngModel)]="user.email_" class="!pl-14 w-full" placeholder="tu@email.com">
        </div>
      </div>

      <!-- INPUT: Contraseña Nueva -->
      <div class="form-group">
        <label>Nueva Contraseña</label>
        <div class="relative">
          <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
          </div>
          <input type="password" [(ngModel)]="newPassword" class="!pl-14 w-full" placeholder="Dejar en blanco para mantener la actual" autocomplete="new-password">
        </div>
      </div>

      <!-- INPUT: Confirmar Contraseña -->
      <div class="form-group" *ngIf="newPassword.trim().length > 0">
        <label>Confirmar Contraseña</label>
        <div class="relative">
          <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
          </div>
          <input type="password" [(ngModel)]="confirmNewPassword" class="!pl-14 w-full" placeholder="Repite la contraseña" autocomplete="new-password">   
        </div>
      </div>

      <div class="buttons">
        <button class="btn btn-primary" (click)="handleSaveProfile()">Guardar cambios</button>
      </div>
    </div>

    <div class="card danger border-red-900/30">
      <h2 class="text-red-400">Zona de Peligro</h2>
      <p class="description">Acciones irreversibles con tu cuenta</p>
      
      <button
          class="unlike-btn flex items-center gap-1 pr-3"
          (click)="handleDeleteAccount()"
        >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="3 6 5 6 21 6"></polyline>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        </svg>
        <span>Eliminar cuenta</span>
      </button>
      
    </div>
  </ng-container>


  <!-- 2. HISTORIAL -->
  <ng-container *ngIf="activeTab === 'history'">
    <div class="card">
      <div class="flex justify-between items-center mb-6">
        <div>
          <h2>Historial de Reproducción</h2>
          <p class="description mb-0">Canciones que has escuchado recientemente</p>
        </div>
        <button
          class="unlike-btn flex items-center gap-1 pr-3"
          (click)="clearHistory()"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
          <span>Limpiar</span>
        </button>
      </div>

      <ul class="history-list">
        <li *ngFor="let entry of history" 
             class="history-item flex items-center justify-between cursor-pointer hover:bg-[#1f2130] transition-colors"
            (click)="playSong(entry.song)">
          
          <div class="flex items-center gap-4">
            <img 
              [src]="entry.song.thumbnailURL_ || 'assets/default-thumbnail.png'" 
              class="thumbnail" 
              alt="Miniatura"
            />
            <div class="song-info">
              <p class="title">{{ entry.song.title_ }}</p>
              <p class="artist">{{ entry.song.artist_ }}</p>
            </div>
          </div>

          <div class="text-right">
            <span class="text-xs text-gray-500 font-mono uppercase tracking-wider">
              {{ entry.listenedAt.formatted }}
            </span>
          </div>

        </li>
      </ul>

      <div *ngIf="history.length === 0" class="text-center py-8 text-gray-500 italic">
        No tienes historial reciente.
      </div>
    </div>
  </ng-container>

  <!-- 3. PREFERENCIAS -->
  <ng-container *ngIf="activeTab === 'preferences'">
    <div class="card">
      <h2>Social y Privacidad</h2>
      <p class="description">Controla quién ve tu actividad y cómo interactúas.</p>

      <!-- CHECKBOX 1: Sesión Privada -->
      <div class="flex items-center justify-between py-4 border-b border-gray-800">
        <div>
          <label class="text-white font-medium block">Sesión privada</label>
          <small class="text-gray-500">Tus amigos no podrán ver qué estás escuchando.</small>
        </div>
        
        <div class="toggle-wrapper">
          <input 
            type="checkbox" 
            [(ngModel)]="privateSession" 
            id="toggle-private" 
            class="toggle-checkbox"
            [class.active]="privateSession"
          />
          <label for="toggle-private" class="toggle-label" [class.active]="privateSession"></label>
        </div>
      </div>

      <!-- CHECKBOX 2: Actividad Amigos -->
      <div class="flex items-center justify-between py-4">
        <div>
          <label class="text-white font-medium block">Ver actividad de amigos</label>
          <small class="text-gray-500">Habilita la sección para descubrir qué escuchan tus amigos.</small>
        </div>
        
        <div class="toggle-wrapper">
          <input 
            type="checkbox" 
            [(ngModel)]="showFriendActivity" 
            id="toggle-activity" 
            class="toggle-checkbox"
            [class.active]="showFriendActivity"
          />
          <label for="toggle-activity" class="toggle-label" [class.active]="showFriendActivity"></label>
        </div>
      </div>

      <!-- Botones de Acción -->
      <div class="buttons mt-8">
        <button class="btn btn-outline" (click)="handleResetSettings()">Restablecer</button>
        
        <button class="btn btn-primary" (click)="savePreferences()">Guardar Cambios</button>
      </div>
    </div>
  </ng-container>

  <!-- Likes -->
  <section *ngIf="activeTab === 'likes'" class="settings-card">
    <div class="card">
      <h2>Favoritos</h2>
      <p class="description">Canciones a las que has dado "Me gusta".</p>

      <ng-container *ngIf="likedSongs.length > 0; else noLikes">
        <ul class="history-list">
          <li *ngFor="let song of likedSongs" 
            class="history-item flex items-center justify-between cursor-pointer hover:bg-[#1f2130] transition-colors"
            (click)="playSong(song)">
            <div class="flex items-center gap-4 flex-1">
              <img
                [src]="song.thumbnailURL_"
                alt="thumbnail"
                class="thumbnail"
              />
              <div class="song-info">
                <p class="title">{{ song.title_ }}</p>
                <p class="artist">{{ song.artist_ }}</p>
              </div>
            </div>
            <!-- Grupo DERECHA: Botón Eliminar -->
            <button
              class="unlike-btn flex items-center gap-1 pr-3"
              (click)="unlikeFromSettings(song)"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
              <span>Eliminar</span>
            </button>
          </li>
        </ul>
      </ng-container>

      <ng-template #noLikes>
        <p class="text-center text-gray-400 mt-4">Todavía no has añadido canciones a tus favoritos.</p>
      </ng-template>
    </div>
  </section>

  <!-- 4. ALMACENAMIENTO -->
  <ng-container *ngIf="activeTab === 'storage'">
    <div class="card">
      <h2>Caché y Datos</h2>
      <div class="cache-display">
        <p class="large">{{ cacheSize }}</p>
        <p class="small">Almacenamiento en caché</p>
      </div>
      <div class="flex justify-center">
        <button
          class="unlike-btn flex items-center gap-1 pr-3"
          (click)="handleClearCache()"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
          <span>Limpiar caché</span>
        </button>
      </div>
    </div>

    <div class="card text-center">
      <h2>Acerca de Tempo</h2>
      <div class="text-gray-400 text-sm space-y-1 mb-6 mt-4">
        <p>Versión: 1.0.0</p>
        <p>Licencia: MIT</p>
        <p>Desarrollado por Equipo Tempo</p>
      </div>
      <button class="text-blue-500 hover:text-blue-400 text-sm hover:underline" (click)="handleResetSettings()">Restablecer configuración</button>
    </div>
  </ng-container>
  <!-- Overlay de Mensaje -->
  <div id="overlay-message" class="overlay">
    <div class="overlay-box" *ngIf="overlayMessage">{{ overlayMessage }}</div>
  </div>

</div>